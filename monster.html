<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch the monster</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div id="wrap">
        <div id="background">
            <div class="small-btns">
                <button class="small-btn top-btn btnStyle">‚ñ≤</button>
                <div class="samll-btn left-right-btn">
                    <button class="small-btn left-btn btnStyle">‚óÄ</button>
                    <button class="small-btn right-btn btnStyle">‚ñ∂</button>
                </div>
                <button class="small-btn bottom-btn btnStyle">‚ñº</button>
            </div>
            <div class="roundBtn">
                <button class="saveBtn">SAVE</button>
            </div>
            <canvas id="canvas1" width="1100" height="600"></canvas>
            <canvas id="canvas" width="1100" height="600" class="hidden"></canvas>
            <div id="gameover" class="hidden">GAME OVER</div>
            <!-- form Îã§Ïãú ÏÑ§Ï†ï -->
            <form action="#" method="get">
                <table>
                    <tr>
                        <td>
                            <input type="text" id="writeId" placeholder="IDÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî." required>
                        </td>
                    </tr>
                </table>
                <a href="#"><button id="btn" type=submit value="submit">Start</button></a>
            </form>
            <img src="./img/mario1.png" id="maimg" style="display: none;">
            <img src="./img/mario_mushroom.png" style="display: none;" class="monster">
            <img src="./img/mario_flower.png" style="display: none;" class="monster">
            <img src="./img/mario_mushroom_green.png" style="display: none;" class="monster">
            <img src="./img/present.png" style="display: none;" class="monster">
            <audio controls autoplay> 
                <source src="SuperMarioThemeSong.mp3" type="audio/mpeg"> 
            </audio> 
            <div id="main-info" class="hidden">
                <img src="./img/mario.png" alt="" id="player">
                <p id="level">Level 01</p>
                <p id="playerId">ID</p>
                <progress id="level-gauge" data-label="EXP 0/100" value="0" max="100"></progress>
            </div>
            <style type="text/css">* {cursor: url(https://cur.cursors-4u.net/cursors/cur-2/cur104.cur), auto !important;}</style><a href="https://www.cursors-4u.com/cursor/2008/11/24/cool-orange-pointer.html" target="_blank" title="Cool Orange Pointer"><img src="https://cur.cursors-4u.net/cursor.png" border="0" alt="Cool Orange Pointer" style="position:absolute; top: 0px; right: 0px;" /></a>
        </div>
    </div>
</body>
    <script>
        let canvas1 = document.querySelector('#canvas1');
        let canvas = document.querySelector('#canvas');
        let ctx = canvas.getContext('2d');
        
        //Î≥ÄÏàòÎßåÎì§Í∏∞
        // let mouseCursor = document.querySelector(".cursor");
        let startBtn = document.querySelector('#btn');
        let topBtn = document.querySelector('.top-btn');
        let leftBtn = document.querySelector('.left-btn');
        let rightBtn = document.querySelector('.right-btn');
        let bottomBtn = document.querySelector('.bottom-btn');
        let gameover = document.querySelector('#gameover');
        let writeId = document.querySelector('#writeId');
        let mainInfo = document.querySelector('#main-info');
        let animation;          
        // let timer = 40;
        let marioImg = new Image();
        marioImg.src = "./img/mario1.png";
        let player = document.querySelector('#player');
        let levelUp = document.querySelector('#level-gauge');
        let monImgs = document.querySelectorAll('.monster');
        let monstersCaught = 0;

        // ÎßàÏö∞Ïä§Ïª§ÏÑú
        //-Ïù¥ÎØ∏ÏßÄ ÏÑ§Ï†ïÌï¥ÏÑú Îã§ÏãúÌïòÍ∏∞..!
        // window.addEventListener("mousemove", cursor);
        // function cursor(e) {
        //     mouseCursor.style.left = e.pageX + "px";
        //     mouseCursor.style.top = e.pageY + "px";
        // }
        
        // start Î≤ÑÌäº ÎàÑÎ•º Îïå,        
        startBtn.addEventListener("click", (e) => {
                gameStart();
                canvas1.classList.add("hidden");
                canvas.classList.remove("hidden");
                gameover.classList.add("hidden");
                startBtn.classList.add("hidden");
                player.classList.remove("hidden");
                mainInfo.classList.remove("hidden");
                writeId.classList.add("hidden");
        });   

        // *main-infoÏòÅÏó≠
        //üò¢ÌîåÎ†àÏù¥Ïñ¥(Í≤åÏûÑÌïòÎã®Ïóê ÎßàÎ¶¨Ïò§ Ï∫êÎ¶≠ÌÑ∞)
        // let player = {
        //     x: 800,
        //     y: 10,
        //     width: 60,
        //     height: 100,
        //     drawP() {
        //         ctx.drawImage(playerImg, this.x, this.y, this.width, this.height);
        //     }
        // }
        // player.drawP();
        //üò¢Í≤ΩÌóòÏπò
        //-> Ïò§Î•¥Í≤å ÏàòÏ†ïÌï¥ÏïºÌï®..„Ö†„Ö†
        // function monInfoChange() {
        //     curObj.exp += (20 - Math.round(this.timeBetweenSteps / 100));  
        //     // (ÎåÄÏ∂© ÎûúÎç§ÏßÄÏ†ïÎêòÎäî this.timeBetweenStepsÍ∞íÏóê ÎπÑÎ°ÄÌïòÍ≤å Í≤ΩÌóòÏπò(exp)Î•º Ï§ÄÎã§Îäî Ïãù)
        //     progress.setAttribute('data-label', `EXP ${curObj.exp}/100`);
        //     progress.value = curObj.exp;
        //     if (curObj.exp >= 100) {    // Í≤ΩÌóòÏπòÍ∞Ä 100Ïù¥ÎêòÎ©¥ Î†àÎ≤®ÏóÖ, Í≤ΩÌóòÏπò Ï¥àÍ∏∞Ìôî
        //         curObj.level++;
        //         levelText.textContent = `Level ${curObj.level}`;
        //         curObj.exp -= 100;
        //         progress.setAttribute('data-label', `EXP ${curObj.exp}/100`);
        //         progress.value = curObj.exp;
        //     }
        // }


        //Ï∫êÎ¶≠ÌÑ∞ Í∞ùÏ≤¥ ÎßåÎì§Í∏∞
        let gameU = {
            x : 500,
            y : 240,
            width: 70,
            height: 90,
            speed: 3,       // Ï∫êÎ¶≠ÌÑ∞Ïùò Ïù¥Îèô ÏÜçÎèÑ(Ï¥àÎãπ ÌîΩÏÖÄ Ïàò)
            draw() {
                ctx.drawImage(marioImg, this.x,this.y, this.width,this.height);
            }
        }
        gameU.draw(); 


        //Î™¨Ïä§ÌÑ∞ Î∞∞Ïó¥
        let monArr = [];
        class Monster {
            constructor(x,y){
                this.x = x;
                this.y = y;
                this.width = 60;
                this.height = 60;
                this.num = Math.floor(Math.random()*4);
            }
            draw() {
                ctx.drawImage(monImgs[this.num],this.x, this.y, this.width, this.height);
            }
            
        }                
        
        //Ï∫êÎ¶≠ÌÑ∞ ÌÇ§Ïù¥Î≤§Ìä∏
        let keysDown = {};
        window.addEventListener("keydown", function (key) {
            keysDown[key.keyCode] = true;
            // console.log(keysDown);
            keydown(key);
        }, false);
        window.addEventListener("keyup", function (key) {
            delete keysDown[key.keyCode];
            keyup(key);
        }, false);

        let keycode;
        function keydown(e){
            //ÎàåÎü¨ÏßÑ keyÏùò ÏΩîÎìúÍ∞í
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            keycode = e.keyCode;
            switch(keycode){
                case 37:        //left
                gameU.x += -3 * gameU.speed;         
                leftBtn.classList.remove("btnStyle");           
                leftBtn.classList.add("click"); 
                // console.log('keydown');           
                    break; 
                case 38:        //up
                gameU.y += -3 * gameU.speed;
                topBtn.classList.remove("btnStyle");           
                topBtn.classList.add("click");  
                    break; 
                case 39:        //right
                gameU.x += 3 * gameU.speed; 
                rightBtn.classList.remove("btnStyle");           
                rightBtn.classList.add("click"); 
                    break; 
                case 40:        //down
                gameU.y += 3 * gameU.speed; 
                bottomBtn.classList.remove("btnStyle");           
                bottomBtn.classList.add("click"); 
                    break; 
            }
            gameU.draw();
        }
        function keyup(e){
            //Îñ®Ïñ¥ÏßÑ keyÏùò ÏΩîÎìúÍ∞í
            keycode=e.keyCode;
            switch(keycode){
                case 37:            //left
                leftBtn.classList.remove("click");           
                leftBtn.classList.add("btnStyle");  
                // console.log('keyup');      
                    break;  
                case 39:            //right
                rightBtn.classList.remove("click");           
                rightBtn.classList.add("btnStyle");
                    break;
                case 38:            //up
                topBtn.classList.remove("click");           
                topBtn.classList.add("btnStyle");
                    break;
                case 40:            //down
                bottomBtn.classList.remove("click");           
                bottomBtn.classList.add("btnStyle");
                    break;
            }
        }   

        var time = 40; 
        var finished = false;
        var times =function(){
            time=time-1;        //1Ï¥àÏî© Í∞êÏÜå!
            // 0Ï¥àÍ∞Ä ÎêòÎ©¥ -> Ï∫êÎ¶≠ÌÑ∞, Î™¨Ïä§ÌÑ∞ hide! + Í≤åÏûÑÏò§Î≤Ñ Î¨∏Íµ¨ Îú®Í≤å!!
                if (time <= 0)
                {
                // stop the timer
                clearInterval(times);
                // set game to finished
                finished = true;
                time=0;
                gameover.classList.remove("hidden");
                cancelAnimationFrame(animation);
                gameU.width = 0;
                }
        }
        // ÌÉÄÏù¥Î®∏ Í∞ÑÍ≤©(Îß§ 1Ï¥à (1000ms))
        setInterval(times, 1000);

        //*Í≤åÏûÑÏãúÏûë(animation)
        let monsterCon=true;
        let mon;
        function gameStart(){           
            animation = requestAnimationFrame(gameStart);
            // timer = timer-1;
            // contex.clearRect(0,0,window.innerWidth,window.innerHeight);
            // Î™¨Ïä§ÌÑ∞ ÎûúÎç§ÌïòÍ≤å ÏúÑÏπòÌïòÍ≤å! 
            if(monsterCon){
                mon = new Monster( ( 60+(Math.random()*(canvas.width-120))), (60 +(Math.random()*(canvas.height-120))) );
                console.log(mon);
                monsterCon=false;
            }
            //üò¢Ìïú ÌåêÎãπ Î™¨Ïä§ÌÑ∞Í∞Ä..Í≥ÑÏÜç Í∞ôÏùÄ Ïï†Îì§Îßå ÎÇòÏò¥!
            mon.draw();
            gameU.draw();
            catchCheck(gameU, mon);
            // display ÏãúÍ∞Ñ 
            ctx.fillStyle = "rgb(250, 250, 250)";
            ctx.font = "24px Helveticas";
            ctx.textAlign = "left";
            ctx.textBaseline = "top";
            ctx.fillText("Monsters caught: " + monstersCaught, 20, 30);
            //üò¢ÏãúÍ∞ÑÏù¥ ÏûêÍæ∏ Ïù¥ÏÉÅÌïòÍ≤å..Îß® Ï≤òÏùå Ïà´ÏûêÍ∞Ä ÏïàÏÇ¨ÎùºÏßê..!
            ctx.fillText("Time: " + time, 20, 100);
            // game over message Îú®Í≤å!!
            if(finished==true){
                ctx.fillText("Game over!", 200, 240);
            }
        };

        // Ï∫êÎ¶≠ÌÑ∞Í∞Ä Î™¨Ïä§ÌÑ∞ Ïû°ÏúºÎ©¥ Ï∫êÎ¶≠ÌÑ∞, Î™¨Ïä§ÌÑ∞ ÏúÑÏπò reset
        let reset = function () {
            //Ï∫êÎ¶≠ÌÑ∞ Ï∫îÎ≤ÑÏä§ Ï§ëÏïôÏóê(position to center of canvas)
            gameU.x = canvas.width / 2;
            gameU.y = canvas.height / 2;
            //Î™¨Ïä§ÌÑ∞ ÎûúÎç§ÌïòÍ≤å ÏúÑÏπò(on the canvas randomly)
            mon.x = 60 + (Math.random() * (canvas.width - 120));
            mon.y = 60 + (Math.random() * (canvas.height - 120));
        };
        //Ï∫êÎ¶≠ÌÑ∞ÏôÄ Î™¨Ïä§ÌÑ∞Í∞Ä ÎßåÎÇòÎ©¥(Ïû°ÏúºÎ©¥)
        //üò¢Ï∫êÎ¶≠ÌÑ∞ ÏÇ¨Ïù¥Ï¶àÏóÖ!(Î™¨Ïä§ÌÑ∞Ïù¥ÎØ∏ÏßÄ4Î≤à(Ïù∏Îç±Ïä§3) ÎßåÎÇ† Îïå)
        // function charSize(){
        //     gameU.width = 75;
        //     gameU.height = 95;
        // }
        //Ï∂©ÎèåÏ≤¥ÌÅ¨ - Ï∂©ÎèåÌïòÎ©¥ Ï∫êÎ¶≠ÌÑ∞ÏôÄ Î™¨Ïä§ÌÑ∞ resetÎê®!
        function catchCheck(gameU, mon){
            if (
                gameU.x <= (mon.x + 60)
                && mon.x <= (gameU.x + 70)
                && gameU.y <= (mon.y + 60)
                && mon.y <= (gameU.y + 90)
                ) {
                ++monstersCaught;
                // cancelAnimationFrame(animation);
                reset();
            //üò¢ÏàòÏ†ï
            // if(monImgs[3]){
            //     setInterval(charSize(),5000);
            // }
            }
        }
    </script>
</html>
